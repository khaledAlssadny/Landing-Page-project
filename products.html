<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products - ShopHub</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f5f5;
      }

      /* Header */
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 28px;
        font-weight: bold;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .logout-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid white;
        padding: 8px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s;
      }

      .logout-btn:hover {
        background: white;
        color: #667eea;
      }

      /* Main Container */
      .container {
        max-width: 1200px;
        margin: 30px auto;
        padding: 0 20px;
      }

      .page-title {
        text-align: center;
        margin-bottom: 30px;
      }

      .page-title h1 {
        font-size: 36px;
        color: #333;
        margin-bottom: 10px;
      }

      .page-title p {
        color: #666;
        font-size: 16px;
      }

      /* Loading Spinner */
      .loading {
        text-align: center;
        padding: 50px;
        font-size: 18px;
        color: #667eea;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Products Grid */
      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        margin-top: 20px;
      }

      .product-card {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
        cursor: pointer;
      }

      .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      }

      .product-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
        background: #f8f8f8;
      }

      .product-info {
        padding: 15px;
      }

      .product-brand {
        font-size: 12px;
        color: #667eea;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 5px;
      }

      .product-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
        height: 40px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .product-price {
        font-size: 24px;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 8px;
      }

      .product-rating {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 14px;
        color: #666;
      }

      .stars {
        color: #ffc107;
      }

      .product-stock {
        font-size: 12px;
        color: #27ae60;
        margin-top: 5px;
        font-weight: 600;
      }

      .out-of-stock {
        color: #e74c3c;
      }

      /* Error Message */
      .error-message {
        background: #ffebee;
        color: #c62828;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        margin: 20px 0;
      }

      /* No Products */
      .no-products {
        text-align: center;
        padding: 50px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <div class="logo">üõçÔ∏è ShopHub</div>
        <div class="user-info">
          <span id="welcomeUser">Welcome!</span>
          <button class="logout-btn" id="logoutBtn">Logout</button>
        </div>
      </div>
    </div>

    <!-- Main Container -->
    <div class="container">
      <div class="page-title">
        <h1>Our Products</h1>
        <p>Discover amazing products at great prices</p>
      </div>

      <!-- Loading Spinner -->
      <div class="loading" id="loadingSection">
        <div class="spinner"></div>
        <p>Loading products...</p>
      </div>

      <!-- Error Message -->
      <div class="error-message" id="errorMessage" style="display: none">
        <h3>Oops! Something went wrong</h3>
        <p id="errorText"></p>
      </div>

      <!-- Products Grid -->
      <div class="products-grid" id="productsGrid"></div>

      <!-- No Products Message -->
      <div class="no-products" id="noProducts" style="display: none">
        <h3>No products found</h3>
        <p>Please try again later</p>
      </div>
    </div>

    <script>
      // ===== COOKIE FUNCTIONS =====
      function getUserFromCookie(cookieName) {
        var name = cookieName + "=";
        var cookies = document.cookie.split(";");
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.indexOf(name) === 0) {
            return decodeURIComponent(cookie.substring(name.length));
          }
        }
        return null;
      }

      function deleteAllCookies() {
        var cookies = document.cookie.split(";");
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i];
          var eqPos = cookie.indexOf("=");
          var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
          document.cookie =
            name.trim() + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
        }
      }

      function saveProductIdToCookie(productId) {
        var expiryDate = new Date();
        expiryDate.setDate(expiryDate.getDate() + 1); // Expires in 1 day
        document.cookie =
          "selectedProductId=" +
          productId +
          "; expires=" +
          expiryDate.toUTCString() +
          "; path=/";
      }

      // ===== CHECK AUTHENTICATION =====
      function checkIfLoggedIn() {
        var userEmail = getUserFromCookie("loggedInUserEmail");
        var userName = getUserFromCookie("loggedInUserName");

        if (!userEmail) {
          // User not logged in, redirect to index page
          window.location.href = "index.html";
          return false;
        }

        // Display welcome message
        var welcomeUser = document.getElementById("welcomeUser");
        welcomeUser.textContent = "Welcome, " + userName + "!";

        return true;
      }

      // ===== LOGOUT FUNCTION =====
      function handleLogout() {
        deleteAllCookies();
        window.location.href = "index.html";
      }

      // ===== FETCH PRODUCTS USING XMLHttpRequest =====
      function getProducts() {
        var xhr = new XMLHttpRequest();

        xhr.open("GET", "https://dummyjson.com/products", true);

        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            var loadingSection = document.getElementById("loadingSection");
            loadingSection.style.display = "none";

            if (xhr.status === 200) {
              // Success - Parse response
              var response = JSON.parse(xhr.responseText);
              var products = response.products;

              if (products && products.length > 0) {
                displayProducts(products);
              } else {
                document.getElementById("noProducts").style.display = "block";
              }
            } else {
              // Error
              var errorMessage = document.getElementById("errorMessage");
              var errorText = document.getElementById("errorText");
              errorText.textContent =
                "Failed to load products. Status: " + xhr.status;
              errorMessage.style.display = "block";
            }
          }
        };

        xhr.onerror = function () {
          var loadingSection = document.getElementById("loadingSection");
          loadingSection.style.display = "none";

          var errorMessage = document.getElementById("errorMessage");
          var errorText = document.getElementById("errorText");
          errorText.textContent =
            "Network error. Please check your internet connection.";
          errorMessage.style.display = "block";
        };

        xhr.send();
      }

      // ===== DISPLAY PRODUCTS =====
      function displayProducts(products) {
        var productsGrid = document.getElementById("productsGrid");
        productsGrid.innerHTML = "";

        for (var i = 0; i < products.length; i++) {
          var product = products[i];

          // Create product card
          var card = document.createElement("div");
          card.className = "product-card";
          card.setAttribute("data-product-id", product.id);

          // Product image
          var img = document.createElement("img");
          img.className = "product-image";
          img.src = product.thumbnail;
          img.alt = product.title;
          img.onerror = function () {
            this.src = "https://via.placeholder.com/250x250?text=No+Image";
          };

          // Product info container
          var info = document.createElement("div");
          info.className = "product-info";

          // Brand
          var brand = document.createElement("div");
          brand.className = "product-brand";
          brand.textContent = product.brand || "Generic";

          // Title
          var title = document.createElement("div");
          title.className = "product-title";
          title.textContent = product.title;

          // Price
          var price = document.createElement("div");
          price.className = "product-price";
          price.textContent = "$" + product.price;

          // Rating
          var rating = document.createElement("div");
          rating.className = "product-rating";
          var stars = document.createElement("span");
          stars.className = "stars";
          stars.textContent = "‚≠ê " + product.rating.toFixed(1);
          var reviews = document.createElement("span");
          reviews.textContent =
            "(" + (product.reviews ? product.reviews.length : 0) + " reviews)";
          rating.appendChild(stars);
          rating.appendChild(reviews);

          // Stock
          var stock = document.createElement("div");
          stock.className = "product-stock";
          if (product.stock > 0) {
            stock.textContent = "In Stock: " + product.stock + " items";
          } else {
            stock.textContent = "Out of Stock";
            stock.className = "product-stock out-of-stock";
          }

          // Append all elements
          info.appendChild(brand);
          info.appendChild(title);
          info.appendChild(price);
          info.appendChild(rating);
          info.appendChild(stock);

          card.appendChild(img);
          card.appendChild(info);

          // Add click event to go to details page
          card.addEventListener("click", function () {
            var productId = this.getAttribute("data-product-id");
            goToDetails(productId);
          });

          productsGrid.appendChild(card);
        }
      }

      // ===== GO TO PRODUCT DETAILS =====
      function goToDetails(productId) {
        saveProductIdToCookie(productId);
        window.location.href = "details.html";
      }

      // ===== INITIALIZE PAGE =====
      if (checkIfLoggedIn()) {
        getProducts();
      }

      // Logout button event
      document
        .getElementById("logoutBtn")
        .addEventListener("click", handleLogout);
    </script>
  </body>
</html>
