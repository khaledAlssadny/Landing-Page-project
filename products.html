<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products - ShopHub</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f5f5;
      }

      /* Header */
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 28px;
        font-weight: bold;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .logout-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid white;
        padding: 8px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s;
      }

      .logout-btn:hover {
        background: white;
        color: #667eea;
      }

      /* Main Container */
      .container {
        max-width: 1200px;
        margin: 30px auto;
        padding: 0 20px;
      }

      /* Featured Products Slider */
      .featured-section {
        margin-bottom: 40px;
        text-align: center;
      }

      .featured-title {
        font-size: 28px;
        color: #333;
        margin-bottom: 20px;
        font-weight: bold;
      }

      .featured-slider {
        position: relative;
        height: 400px;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
      }

      .featured-slide {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 0.8s ease-in-out;
        display: flex;
        background: white;
      }

      .featured-slide.active {
        opacity: 1;
        z-index: 1;
      }

      .slide-image {
        width: 50%;
        height: 100%;
        object-fit: cover;
        background: #f0f0f0;
      }

      .slide-info {
        width: 50%;
        padding: 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .slide-badge {
        display: inline-block;
        background: rgba(255, 255, 255, 0.3);
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        margin-bottom: 15px;
        width: fit-content;
      }

      .slide-title {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 15px;
        line-height: 1.2;
      }

      .slide-description {
        font-size: 16px;
        line-height: 1.6;
        margin-bottom: 20px;
        opacity: 0.9;
      }

      .slide-price {
        font-size: 42px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #ffd700;
      }

      .slide-discount {
        display: inline-block;
        background: #e74c3c;
        color: white;
        padding: 8px 15px;
        border-radius: 5px;
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 20px;
        width: fit-content;
      }

      .slide-rating {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        margin-bottom: 25px;
      }

      .slide-stars {
        color: #ffd700;
      }

      .slide-button {
        background: white;
        color: #667eea;
        border: none;
        padding: 15px 35px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        width: fit-content;
      }

      .slide-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .slider-controls {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 2;
      }

      .slider-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: all 0.3s;
      }

      .slider-dot.active {
        background: white;
        width: 35px;
        border-radius: 6px;
      }

      .slider-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.9);
        color: #667eea;
        border: none;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.3s;
        z-index: 2;
        font-weight: bold;
      }

      .slider-arrow:hover {
        background: white;
        transform: translateY(-50%) scale(1.1);
      }

      .slider-arrow.prev {
        left: 15px;
      }

      .slider-arrow.next {
        right: 15px;
      }

      .page-title {
        text-align: center;
        margin-bottom: 30px;
      }

      .page-title h1 {
        font-size: 36px;
        color: #333;
        margin-bottom: 10px;
      }

      .page-title p {
        color: #666;
        font-size: 16px;
      }

      /* Loading Spinner */
      .loading {
        text-align: center;
        padding: 50px;
        font-size: 18px;
        color: #667eea;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Products Grid */
      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 25px;
        margin-top: 20px;
      }

      .product-card {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
        cursor: pointer;
      }

      .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      }

      .product-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
        background: #f8f8f8;
      }

      .product-info {
        padding: 15px;
      }

      .product-brand {
        font-size: 12px;
        color: #667eea;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 5px;
      }

      .product-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
        height: 40px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .product-price {
        font-size: 24px;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 8px;
      }

      .product-rating {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 14px;
        color: #666;
      }

      .stars {
        color: #ffc107;
      }

      .product-stock {
        font-size: 12px;
        color: #27ae60;
        margin-top: 5px;
        font-weight: 600;
      }

      .out-of-stock {
        color: #e74c3c;
      }

      /* Error Message */
      .error-message {
        background: #ffebee;
        color: #c62828;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        margin: 20px 0;
      }

      /* No Products */
      .no-products {
        text-align: center;
        padding: 50px;
        color: #666;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .featured-slider {
          height: auto;
        }

        .featured-slide {
          flex-direction: column;
        }

        .slide-image {
          width: 100%;
          height: 250px;
        }

        .slide-info {
          width: 100%;
          padding: 30px 20px;
        }

        .slide-title {
          font-size: 24px;
        }

        .slide-price {
          font-size: 32px;
        }

        .slider-arrow {
          width: 35px;
          height: 35px;
          font-size: 16px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <div class="logo">üõçÔ∏è ShopHub</div>
        <div class="user-info">
          <span id="welcomeUser">Welcome!</span>
          <button class="logout-btn" id="logoutBtn">Logout</button>
        </div>
      </div>
    </div>

    <!-- Main Container -->
    <div class="container">
      <!-- Featured Products Slider -->
      <div class="featured-section">
        <h2 class="featured-title">Featured Products</h2>
        <div class="featured-slider" id="featuredSlider">
          <!-- Slides will be added dynamically -->
          <div class="slider-controls" id="sliderControls"></div>
          <button class="slider-arrow prev" id="prevBtn">‚ùÆ</button>
          <button class="slider-arrow next" id="nextBtn">‚ùØ</button>
        </div>
      </div>

      <div class="page-title">
        <h1>All Products</h1>
        <p>Discover amazing products at great prices</p>
      </div>

      <!-- Loading Spinner -->
      <div class="loading" id="loadingSection">
        <div class="spinner"></div>
        <p>Loading products...</p>
      </div>

      <!-- Error Message -->
      <div class="error-message" id="errorMessage" style="display: none">
        <h3>Oops! Something went wrong</h3>
        <p id="errorText"></p>
      </div>

      <!-- Products Grid -->
      <div class="products-grid" id="productsGrid"></div>

      <!-- No Products Message -->
      <div class="no-products" id="noProducts" style="display: none">
        <h3>No products found</h3>
        <p>Please try again later</p>
      </div>
    </div>

    <script>
      // ===== COOKIE FUNCTIONS =====
      function getUserFromCookie(cookieName) {
        var name = cookieName + "=";
        var cookies = document.cookie.split(";");
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.indexOf(name) === 0) {
            return decodeURIComponent(cookie.substring(name.length));
          }
        }
        return null;
      }

      function deleteAllCookies() {
        var cookies = document.cookie.split(";");
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i];
          var eqPos = cookie.indexOf("=");
          var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
          document.cookie =
            name.trim() + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
        }
      }

      function saveProductIdToCookie(productId) {
        var expiryDate = new Date();
        expiryDate.setDate(expiryDate.getDate() + 1);
        document.cookie =
          "selectedProductId=" +
          productId +
          "; expires=" +
          expiryDate.toUTCString() +
          "; path=/";
      }

      // ===== CHECK AUTHENTICATION =====
      function checkIfLoggedIn() {
        var userEmail = getUserFromCookie("loggedInUserEmail");
        var userName = getUserFromCookie("loggedInUserName");

        if (!userEmail) {
          window.location.href = "index.html";
          return false;
        }

        var welcomeUser = document.getElementById("welcomeUser");
        welcomeUser.textContent = "Welcome, " + userName + "!";

        return true;
      }

      // ===== LOGOUT FUNCTION =====
      function handleLogout() {
        deleteAllCookies();
        window.location.href = "index.html";
      }

      // ===== FETCH PRODUCTS USING XMLHttpRequest =====
      function getProducts() {
        var xhr = new XMLHttpRequest();

        xhr.open("GET", "https://dummyjson.com/products", true);

        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            var loadingSection = document.getElementById("loadingSection");
            loadingSection.style.display = "none";

            if (xhr.status === 200) {
              var response = JSON.parse(xhr.responseText);
              var products = response.products;

              if (products && products.length > 0) {
                // Create featured slider with first 5 products
                createFeaturedSlider(products.slice(0, 5));
                // Display all products
                displayProducts(products);
              } else {
                document.getElementById("noProducts").style.display = "block";
              }
            } else {
              var errorMessage = document.getElementById("errorMessage");
              var errorText = document.getElementById("errorText");
              errorText.textContent =
                "Failed to load products. Status: " + xhr.status;
              errorMessage.style.display = "block";
            }
          }
        };

        xhr.onerror = function () {
          var loadingSection = document.getElementById("loadingSection");
          loadingSection.style.display = "none";

          var errorMessage = document.getElementById("errorMessage");
          var errorText = document.getElementById("errorText");
          errorText.textContent =
            "Network error. Please check your internet connection.";
          errorMessage.style.display = "block";
        };

        xhr.send();
      }

      // ===== CREATE FEATURED SLIDER =====
      function createFeaturedSlider(featuredProducts) {
        var slider = document.getElementById("featuredSlider");
        var controls = document.getElementById("sliderControls");

        // Clear existing slides
        var existingSlides = slider.querySelectorAll(".featured-slide");
        for (var i = 0; i < existingSlides.length; i++) {
          slider.removeChild(existingSlides[i]);
        }
        controls.innerHTML = "";

        // Create slides
        for (var i = 0; i < featuredProducts.length; i++) {
          var product = featuredProducts[i];

          // Create slide
          var slide = document.createElement("div");
          slide.className = "featured-slide";
          if (i === 0) {
            slide.classList.add("active");
          }

          // Image
          var img = document.createElement("img");
          img.className = "slide-image";
          img.src = product.thumbnail;
          img.alt = product.title;
          img.onerror = function () {
            this.src = "https://via.placeholder.com/600x400?text=Product";
          };

          // Info section
          var info = document.createElement("div");
          info.className = "slide-info";

          // Badge
          var badge = document.createElement("span");
          badge.className = "slide-badge";
          badge.textContent = "Featured Deal";

          // Title
          var title = document.createElement("h3");
          title.className = "slide-title";
          title.textContent = product.title;

          // Description
          var desc = document.createElement("p");
          desc.className = "slide-description";
          desc.textContent =
            product.description.length > 120
              ? product.description.substring(0, 120) + "..."
              : product.description;

          // Price
          var price = document.createElement("div");
          price.className = "slide-price";
          price.textContent = "$" + product.price;

          // Discount
          if (product.discountPercentage > 0) {
            var discount = document.createElement("div");
            discount.className = "slide-discount";
            discount.textContent =
              "Save " + product.discountPercentage.toFixed(0) + "%";
            info.appendChild(badge);
            info.appendChild(title);
            info.appendChild(desc);
            info.appendChild(price);
            info.appendChild(discount);
          } else {
            info.appendChild(badge);
            info.appendChild(title);
            info.appendChild(desc);
            info.appendChild(price);
          }

          // Rating
          var rating = document.createElement("div");
          rating.className = "slide-rating";
          var stars = document.createElement("span");
          stars.className = "slide-stars";
          stars.textContent = "‚≠ê " + product.rating.toFixed(1);
          var ratingText = document.createElement("span");
          ratingText.textContent = "Highly Rated";
          rating.appendChild(stars);
          rating.appendChild(ratingText);

          // Button
          var button = document.createElement("button");
          button.className = "slide-button";
          button.textContent = "View Details";
          button.setAttribute("data-product-id", product.id);
          button.addEventListener("click", function () {
            var productId = this.getAttribute("data-product-id");
            goToDetails(productId);
          });

          info.appendChild(rating);
          info.appendChild(button);

          slide.appendChild(img);
          slide.appendChild(info);

          // Insert before controls
          slider.insertBefore(slide, controls);

          // Create dot
          var dot = document.createElement("span");
          dot.className = "slider-dot";
          if (i === 0) {
            dot.classList.add("active");
          }
          dot.setAttribute("data-slide", i);
          controls.appendChild(dot);
        }

        // Initialize slider
        initSlider();
      }

      // ===== SLIDER FUNCTIONALITY =====
      var currentSlide = 0;
      var slideInterval;

      function initSlider() {
        var slides = document.querySelectorAll(".featured-slide");
        var dots = document.querySelectorAll(".slider-dot");
        var totalSlides = slides.length;

        function showSlide(index) {
          for (var i = 0; i < slides.length; i++) {
            slides[i].classList.remove("active");
            dots[i].classList.remove("active");
          }
          slides[index].classList.add("active");
          dots[index].classList.add("active");
          currentSlide = index;
        }

        function nextSlide() {
          var next = (currentSlide + 1) % totalSlides;
          showSlide(next);
        }

        function prevSlide() {
          var prev = (currentSlide - 1 + totalSlides) % totalSlides;
          showSlide(prev);
        }

        function startAutoSlide() {
          slideInterval = setInterval(function () {
            nextSlide();
          }, 5000); // Change every 5 seconds
        }

        function stopAutoSlide() {
          clearInterval(slideInterval);
        }

        // Next/Prev buttons
        document
          .getElementById("nextBtn")
          .addEventListener("click", function () {
            stopAutoSlide();
            nextSlide();
            startAutoSlide();
          });

        document
          .getElementById("prevBtn")
          .addEventListener("click", function () {
            stopAutoSlide();
            prevSlide();
            startAutoSlide();
          });

        // Dot navigation
        for (var i = 0; i < dots.length; i++) {
          (function (index) {
            dots[index].addEventListener("click", function () {
              stopAutoSlide();
              showSlide(index);
              startAutoSlide();
            });
          })(i);
        }

        // Pause on hover
        var slider = document.getElementById("featuredSlider");
        slider.addEventListener("mouseenter", stopAutoSlide);
        slider.addEventListener("mouseleave", startAutoSlide);

        // Start auto-slide
        startAutoSlide();
      }

      // ===== DISPLAY PRODUCTS =====
      function displayProducts(products) {
        var productsGrid = document.getElementById("productsGrid");
        productsGrid.innerHTML = "";

        for (var i = 0; i < products.length; i++) {
          var product = products[i];

          var card = document.createElement("div");
          card.className = "product-card";
          card.setAttribute("data-product-id", product.id);

          var img = document.createElement("img");
          img.className = "product-image";
          img.src = product.thumbnail;
          img.alt = product.title;
          img.onerror = function () {
            this.src = "https://via.placeholder.com/250x250?text=No+Image";
          };

          var info = document.createElement("div");
          info.className = "product-info";

          var brand = document.createElement("div");
          brand.className = "product-brand";
          brand.textContent = product.brand || "Generic";

          var title = document.createElement("div");
          title.className = "product-title";
          title.textContent = product.title;

          var price = document.createElement("div");
          price.className = "product-price";
          price.textContent = "$" + product.price;

          var rating = document.createElement("div");
          rating.className = "product-rating";
          var stars = document.createElement("span");
          stars.className = "stars";
          stars.textContent = "‚≠ê " + product.rating.toFixed(1);
          var reviews = document.createElement("span");
          reviews.textContent =
            "(" + (product.reviews ? product.reviews.length : 0) + " reviews)";
          rating.appendChild(stars);
          rating.appendChild(reviews);

          var stock = document.createElement("div");
          stock.className = "product-stock";
          if (product.stock > 0) {
            stock.textContent = "In Stock: " + product.stock + " items";
          } else {
            stock.textContent = "Out of Stock";
            stock.className = "product-stock out-of-stock";
          }

          info.appendChild(brand);
          info.appendChild(title);
          info.appendChild(price);
          info.appendChild(rating);
          info.appendChild(stock);

          card.appendChild(img);
          card.appendChild(info);

          card.addEventListener("click", function () {
            var productId = this.getAttribute("data-product-id");
            goToDetails(productId);
          });

          productsGrid.appendChild(card);
        }
      }

      // ===== GO TO PRODUCT DETAILS =====
      function goToDetails(productId) {
        saveProductIdToCookie(productId);
        window.location.href = "details.html";
      }

      // ===== INITIALIZE PAGE =====
      if (checkIfLoggedIn()) {
        getProducts();
      }

      document
        .getElementById("logoutBtn")
        .addEventListener("click", handleLogout);
    </script>
  </body>
</html>
